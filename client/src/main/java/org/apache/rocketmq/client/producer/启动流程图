https://upload-images.jianshu.io/upload_images/6302559-fa5ed991de9c3aa8.jpg


producer启动过程需要创建DefaultMQProducer对象，DefaultMQProducer内部DefaultMQProducerImpl对象。

DefaultMQProducer#start执行DefaultMQProducerImpl#start，DefaultMQProducerImpl的start过程会通过MQClientManager创建MQClientInstance。

MQClientInstance#start是producer启动流程中的最核心流程，包括所有服务的启动以及定时任务的启动。

MQClientInstance#start执行mQClientAPIImpl.start()，负责NettyRemotingClient的启动。

MQClientInstance#start执行startScheduledTask，启动包括获取路由信息等定时任务。

startScheduledTask定时任务会执行fetchNameServerAddr、updateTopicRouteInfoFromNameServer、cleanOfflineBroker、sendHeartbeatToAllBrokerWithLock、persistAllConsumerOffset、adjustThreadPool等核心任务。

MQClientInstance#start执行pullMessageService.start()，负责PullMessageService的启动。

MQClientInstance#start执行rebalanceService.start()，负责RebalanceService的启动。

MQClientInstance作为producer的核心对象，负责了几乎所有模块的启动，在consumer侧同样会用到该核心对象，所以MQClientInstance的启动会启动一些consumer侧的服务。

